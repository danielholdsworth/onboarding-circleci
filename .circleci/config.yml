version: 2.1
 
orbs:
  my-orb:
    jobs:
      my_job:
        docker:
          - image: cimg/base:2021.04
        steps:
          - run: 
              command: | 
                curl -fsSL -o install.sh https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh
                chmod 700 install.sh
                ./install.sh
                
                /home/linuxbrew/.linuxbrew/bin/brew install fidelity/tap/kconnect

                kconnect configure -f https://raw.githubusercontent.com/stone-monkeys/CircleCI-sample-project/main/config.yaml

          - persist_to_workspace:
              root: .
              paths:
                - .

jobs:
  build:
    docker:
      - image: alpine
    steps:
      - attach_workspace:
          at: .
      - run:
          name: Echo 
          command: | 
            echo hello world

            ls -a

            cd kconnect

            ./kconnect help

workflows:
  main:
    jobs:
      - my-orb/my_job